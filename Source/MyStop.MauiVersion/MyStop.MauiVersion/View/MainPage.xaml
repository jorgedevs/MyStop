<?xml version="1.0" encoding="utf-8" ?>
<ContentPage 
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    x:Class="MyStop.MauiVersion.View.MainPage"
    BackgroundColor="{StaticResource SkyColor}"
    Title="Home">

    <ContentPage.ToolbarItems>
        <ToolbarItem 
            IconImageSource="icon_favourites.png"
            Command="{Binding GoToFavoriteStops}" />
    </ContentPage.ToolbarItems>

    <ContentPage.Content>
        <Grid>
            <!-- Main Content (hidden during loading) -->
            <Grid 
                RowSpacing="60"
                IsVisible="{Binding IsLoadingGtfs, Converter={StaticResource InvertedBoolConverter}}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="100" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="75" />
                    <RowDefinition Height="50" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <Image 
                    Grid.Row="0"
                    x:Name="imgCloud1"
                    Source="img_cloud1" 
                    HorizontalOptions="Start"
                    Margin="20,20,0,0" />

                

                <StackLayout 
                    Grid.Row="1"
                    Spacing="5"
                    HorizontalOptions="Center"
                    VerticalOptions="Center">

                    <Label 
                        Text="MyStop" 
                        TextColor="White" 
                        FontSize="35" 
                        FontAttributes="Bold" 
                        HorizontalOptions="Center" />

                    <Label 
                        Text="enter stop number" 
                        TextColor="Aqua" 
                        FontSize="Small" 
                        HorizontalOptions="Center" />

                    <Grid
                        Margin="0" 
                        ColumnSpacing="5">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="40" />
                        </Grid.ColumnDefinitions>

                        <Border 
                            Grid.Column="0" 
                            BackgroundColor="White" 
                            Stroke="White"
                            StrokeThickness="0"
                            Padding="5,0">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="5" />
                            </Border.StrokeShape>
                            <Entry 
                                x:Name="entSearch" 
                                Text="{Binding BusStopNumber}" 
                                FontSize="20" 
                                MaxLength="5" 
                                Placeholder="51195" 
                                TextColor="{StaticResource SkyColor}" 
                                HorizontalTextAlignment="Center" 
                                VerticalOptions="Center" 
                                Keyboard="Numeric" />
                        </Border>

                        <Grid 
                            Grid.Column="1">
                            <Image 
                                Source="icon_search" 
                                Margin="5" 
                                Aspect="AspectFit" />
                            <Button 
                                BackgroundColor="#55FFFFFF" 
                                BorderColor="White"
                                BorderWidth="1" 
                                CornerRadius="5"
                                Command="{Binding GetStopInfoCommand}" />
                        </Grid>
                    </Grid>
                </StackLayout>

                <Image 
                    Grid.Row="2" 
                    x:Name="imgCloud2"
                    Source="img_cloud2" 
                    HorizontalOptions="End"
                    Margin="0,0,20,0"  />

                <Image 
                    Grid.Row="3" 
                    x:Name="imgCloud3"
                    Source="img_cloud3" 
                    HorizontalOptions="Start"
                    Margin="40,10,0,0"  />

                <Grid 
                    Grid.Row="4">
                    <Image 
                        x:Name="imgFooter"
                        Source="bg_home" 
                        Scale="1.1" 
                        HorizontalOptions="Fill" 
                        VerticalOptions="End" />

                    <Image 
                        x:Name="imgBusFront"
                        Source="img_bus_front" 
                        HeightRequest="170" 
                        HorizontalOptions="Start" 
                        VerticalOptions="End" 
                        TranslationY="10" 
                        Margin="30,0,0,0" />

                    <Image 
                        x:Name="imgLamp"
                        Source="img_lamp" 
                        HorizontalOptions="End" 
                        Margin="0,0,5,10" />
                </Grid>
            </Grid>

            <!-- Full-screen Loading Overlay (matches splash screen) -->
            <Grid
                BackgroundColor="#3B70DF"
                IsVisible="{Binding IsLoadingGtfs}">
                
                <!-- Logo in center -->
                <Image 
                    Source="splash"
                    HeightRequest="200"
                    WidthRequest="250"
                    Aspect="AspectFit"
                    HorizontalOptions="Center"
                    VerticalOptions="Center" />

                <!-- Progress section at bottom -->
                <StackLayout
                    Spacing="10"
                    Margin="40,0,40,80"
                    VerticalOptions="End">
                    
                    <Label 
                        Text="{Binding LoadingStatusText}" 
                        TextColor="White" 
                        FontSize="Medium" 
                        HorizontalOptions="Center" />
                    
                    <Label 
                        Text="{Binding CurrentFileName}" 
                        TextColor="White" 
                        FontSize="Caption"
                        Opacity="0.8"
                        HorizontalOptions="Center" />

                    <ProgressBar
                        Progress="{Binding LoadingProgress}"
                        ProgressColor="White"
                        HorizontalOptions="Fill" />
                </StackLayout>
            </Grid>
        </Grid>
    </ContentPage.Content>
</ContentPage>